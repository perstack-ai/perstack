model = "claude-sonnet-4-5"
temperature = 0.3

[provider]
providerName = "anthropic"

envPath = [".env", ".env.local"]

[experts."docker-security-network"]
version = "1.0.0"
description = "Tests network isolation in Docker sandbox"
instruction = """
You are a security tester. Your job is to verify network isolation.

Test 1: Try to access api.anthropic.com (should succeed - in allowlist)
Test 2: Try to access google.com (should FAIL - not in allowlist)
Test 3: Try to access example.com on port 80 (should FAIL - only 443 allowed)

Use the exec tool to run curl commands for each test.
Report the results of each test, then call attemptCompletion with a summary.
"""

[experts."docker-security-network".network]
allowedDomains = ["api.anthropic.com", "*.anthropic.com"]

[experts."docker-security-network".skills."@perstack/base"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"

[experts."docker-security-filesystem"]
version = "1.0.0"
description = "Tests filesystem isolation in Docker sandbox"
instruction = """
You are a security tester. Your job is to verify filesystem isolation.

Test 1: Read a file in the current workspace (should succeed)
Test 2: Try to read /etc/shadow (should FAIL or show container's file, not host)
Test 3: Try path traversal with /../../../etc/passwd (should FAIL)
Test 4: Try to access ~/.ssh/id_rsa (should FAIL - not mounted)

Use readTextFile and exec tools to perform these tests.
Report the results of each test, then call attemptCompletion with a summary.
"""

[experts."docker-security-filesystem".skills."@perstack/base"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"

[experts."docker-security-commands"]
version = "1.0.0"
description = "Tests command execution restrictions in Docker sandbox"
instruction = """
You are a security tester. Your job is to verify command execution restrictions.

Test 1: Run a simple echo command (should succeed)
Test 2: Try to run sudo whoami (should FAIL - no sudo)
Test 3: Try to run docker ps (should FAIL - no docker socket)
Test 4: Try to access /proc/1/root (should FAIL - restricted)

Use the exec tool to perform these tests.
Report the results of each test, then call attemptCompletion with a summary.
"""

[experts."docker-security-commands".skills."@perstack/base"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"

[experts."docker-security-env"]
version = "1.0.0"
description = "Tests environment variable isolation in Docker sandbox"
instruction = """
You are a security tester. Your job is to verify environment variable isolation.

Test 1: Check if ANTHROPIC_API_KEY is available (should be available)
Test 2: Run 'env' command and check what variables are exposed
Test 3: Try to access HOME directory path

Use the exec tool to run 'env' and 'printenv' commands.
Report what environment variables are visible, then call attemptCompletion.
The test passes if ONLY expected variables are visible (no host secrets leaked).
"""

[experts."docker-security-env".skills."@perstack/base"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"

[experts."docker-security-skill-allowlist"]
version = "1.0.0"
description = "Tests skill-level allowedDomains in Docker sandbox"
instruction = """
You are a security tester. Your job is to verify skill-level network allowlist.

Test 1: Try to access api.github.com (should succeed - in skill allowlist)
Test 2: Try to access api.example.com (should FAIL - not in any allowlist)
Test 3: Try to access api.anthropic.com (should succeed - auto-included from provider)

Use the exec tool to run curl commands for each test.
Report the results of each test, then call attemptCompletion with a summary.
"""

[experts."docker-security-skill-allowlist".skills."@perstack/base"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"
allowedDomains = ["api.github.com", "*.github.com"]

[experts."docker-security-multi-skill"]
version = "1.0.0"
description = "Tests multiple skills with different allowedDomains"
instruction = """
You are a security tester. Your job is to verify that multiple skills' allowedDomains are merged.

Test 1: Try to access api.github.com (should succeed - from skill1)
Test 2: Try to access httpbin.org (should succeed - from skill2)
Test 3: Try to access api.example.com (should FAIL - not in any skill's allowlist)

Use the exec tool to run curl commands for each test.
Report the results of each test, then call attemptCompletion with a summary.
"""

[experts."docker-security-multi-skill".skills."skill1"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"
allowedDomains = ["api.github.com"]

[experts."docker-security-multi-skill".skills."skill2"]
type = "mcpStdioSkill"
command = "npx"
packageName = "@perstack/base"
allowedDomains = ["httpbin.org"]
